/*Copyright (C) 2022-2023 Nurudin Imsirovic <github.com/oxou> Updated: 2023-11-21 04:37 PM*/function hex2bin(n=null){if(null==n)return null;var r=(n=n.toLowerCase()).length;if(r%2)throw"Hexadecimal input string length must be even";var t="";for(let e=0;e<r;e+=2)t+=String.fromCharCode(parseInt(n.substr(e,2),16));return t}function bin2hex(n=null){if(null==n)return null;var r=n.length,t="";for(let e=0;e<r;e++){var u=n.charCodeAt(e).toString(16);2>u.length&&(u="0"+u),t+=u}return t}function hexdec(n=null){return null==n?null:parseInt(n,16)}function dechex(n=null){if(null==n)return null;var r=Number(n).toString(16);return r.length%2&&(r="0"+r),r}function str_split(n,r=1){if(0>=r&&(r=1),1==r)return n.split("");var t=n.length,e=[];for(let u=0;u<t/r;u++)e[u]=n.substr(u*r,r);return e}function clamp(n,r,t){return r>n?r:t<n?t:n}function time(){return Math.floor(Date.now()/1e3)}function time_precise(){return Date.now()}function byte_to_uint8clampedarray(n){return n=(n=str_split(n=bin2hex(n),2)).map(n=>hexdec(n)),Uint8ClampedArray.from(n)}function uint8clampedarray_to_byte(n){return n=(n=(n=[...n]).map(n=>hex2bin(dechex(n).padStart(2,"0")))).join("")}function http_get_bytes(n=null){if(null==n)return!1;var r=new XMLHttpRequest;if(r.open("GET",n,!1),r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(),200!=r.status)return null;for(var t=(data=r.response.split("")).length,e=0;e<t;e++){var u=bin2hex(data[e]);u.length>2&&(u=u.substr(2,2),data[e]=hex2bin(u))}return data.join("")}function lerp(n,r,t){return n+(r-n)*t}function deg2rad(n){return n*(Math.PI/180)}function rad2deg(n){return n*(180/Math.PI)}function in_range(n,r,t){return n>=r&&n<=t}function sgn(n){return(n>0)-(n<0)}const fb_header_parts=[{size:2,data:"BM",addr:0},{addr:2,size:4,data:"\0\0\0\0"},{addr:6,size:2,data:"\0\0"},{addr:8,size:2,data:"\0\0"},{addr:10,size:4,data:"6\0\0\0"},{addr:14,size:4,data:"(\0\0\0"},{addr:18,size:4,data:"\0\0\0\0"},{addr:22,size:4,data:"\0\0\0\0"},{addr:26,size:2,data:"\x01\0"},{addr:28,size:2,data:" \0"},{addr:30,size:4,data:"\0\0\0\0"},{addr:34,size:4,data:"\0\0\0\0"},{addr:38,size:4,data:"\0\0\0\0"},{addr:42,size:4,data:"\0\0\0\0"},{addr:46,size:4,data:"\0\0\0\0"},{addr:50,size:4,data:"\0\0\0\0"},{addr:54,size:-1,data:null}];var fb_header_parts_size=17;const fb_HEADER_MAGIC=0,fb_HEADER_FILESIZE=1,fb_HEADER_RESERVED1=2,fb_HEADER_RESERVED2=3,fb_HEADER_OFFSET=4,fb_HEADER_HEADERSIZE=5,fb_HEADER_WIDTH=6,fb_HEADER_HEIGHT=7,fb_HEADER_COLORPLANE=8,fb_HEADER_BITDEPTH=9,fb_HEADER_COMPRESSION=10,fb_HEADER_BITMAPSIZE=11,fb_HEADER_RESHOR=12,fb_HEADER_RESVER=13,fb_HEADER_COLORPALETTE=14,fb_HEADER_IMPORTANTCOLORS=15,fb_HEADER_DATA=16;function fb_le_int(a,e=2,t=!0){return a=dechex(a),a=hex2bin(a=(a=(a=str_split(a=t?a.padStart(e,"0"):a.padEnd(e,"0"),2)).reverse()).join(""))}function fb_le_byte(a){return Number(a=hexdec(a=(a=(a=str_split(a=bin2hex(a),2)).reverse()).join("")))}function fb_create(a,e,t=!1){if(a=Math.floor(a),e=Math.floor(e),16384<a||16384<e)return!1;var r=fb_header_parts,$="",i=a%4,n=fb_create_pixels(a,e),f=a*e*4+e*i;return r.forEach(function(t,i){switch(i){case 1:$+=fb_le_int(f+54,8);return;case 6:$+=fb_le_int(a,8);return;case 7:$+=fb_le_int(e,8);return;case 11:$+=fb_le_int(f,8);return}null!=r[i].data&&($+=r[i].data)}),{header:byte_to_uint8clampedarray($),header_size:$.length,header_raw:$,width:a,height:e,bitmap:n,bitmap_raw:null,bitmap_size:f,padding:i,filesize:a*e*4+54,bpp:4,canvas:t,reference:null}}function fb_valid(a,e=!1){var t=e?a:a.header_raw,r=!1;try{r="B"==t[0]&&"M"==t[1]}catch($){return!1}return r}function fb_get_pixel(a,e,t){if(e=Math.floor(e),t=Math.floor(t),e>a.width-1||t>a.height-1||0>e||0>t)return[0,0,0,255];var r,$,i,n,f=fb_getpos_32(a.width,a.height,e,t,!a.canvas);return a.canvas?(i=Number(a.bitmap.data[f+2]),$=Number(a.bitmap.data[f+1]),r=Number(a.bitmap.data[f+0]),n=Number(a.bitmap.data[f+3])):(i=Number(a.bitmap.data[f+0]),$=Number(a.bitmap.data[f+1]),r=Number(a.bitmap.data[f+2]),n=Number(a.bitmap.data[f+3])),r=isNaN(r)?0:r,$=isNaN($)?0:$,[r,$,i=isNaN(i)?0:i,n=isNaN(n)?0:n]}function fb_set_pixel(a,e,t,r=null,$=null,i=null,n=null){if(e=Math.floor(e),t=Math.floor(t),e>a.width-1||t>a.height-1||0>e||0>t)return!0;r=Math.floor(Number(r)),$=Math.floor(Number($)),i=Math.floor(Number(i)),r=isNaN(r)?0:r,$=isNaN($)?0:$,i=isNaN(i)?0:i;var f=fb_getpos_32(a.width,a.height,e,t,!a.canvas);return a.canvas?(a.bitmap.data[f+0]=r,a.bitmap.data[f+1]=$,a.bitmap.data[f+2]=i,null!=n&&(a.bitmap.data[f+3]=n),!0):(a.bitmap.data[f+0]=i,a.bitmap.data[f+1]=$,a.bitmap.data[f+2]=r,null!=n&&(a.bitmap.data[f+3]=n),!0)}function fb_to_bytes(a){var e=a.bitmap.data,t=a.width,r=a.padding,$="";return e=str_split(e=(e=(e=[...e]).map(a=>dechex(a).padStart(2,"0"))).join(""),6*t),$=String("00").repeat(r),e=hex2bin(e=e.join($)+$),a.bitmap_raw=e,!0}function fb_size(a){return!!fb_valid(a)&&[a.width,a.height]}function fb_get_pixels(a){return!!fb_valid(a)&&a.bitmap.data}function fb_create_pixels(a,e){a=Math.abs(a),e=Math.abs(e);var t=new ImageData(a,e);for(let r=0;r<a;r++)for(let $=0;$<e;$++){var i=fb_getpos_32(a,e,r,$);t.data[i+3]=255}return t}function fb_reset_alpha(a){if(!fb_valid(a))return!1;for(let e=0;e<width;e++)for(let t=0;t<height;t++){var r=fb_getpos_32(width,height,e,t);a.bitmap.data[r+3]=255}return!0}function fb_create_uri(a){var e=a;if(a.canvas){e=fb_create(a.width,a.height);for(let t=0;t<a.width;t++)for(let r=0;r<a.height;r++){var $=fb_get_pixel(a,t,r);fb_set_pixel(e,t,r,$[0],$[1],$[2])}}var i=new Blob([e.header,e.bitmap.data],{type:"image/bmp"});return URL.createObjectURL(i)}function fb_spawn(a,e=null){if(!fb_valid(a)||null==e)return!1;if(a.canvas){var t=document.createElement("canvas");return t.context=t.getContext("2d",{alpha:!1}),e.appendChild(t),t.width=a.width,t.height=a.height,fb_to_canvas(t,a),a.reference=t,t}var r=document.createElement("img");return r.src=fb_create_uri(a),e.appendChild(r),a.reference=r,r}function fb_replace(a=null,e){return!!(null!=a&&fb_valid(e))&&(a instanceof HTMLCanvasElement?(fb_to_canvas(a,e),!0):(URL.revokeObjectURL(a.src),a.src=fb_create_uri(e),!0))}function fb_filesize(a){return a.filesize}function fb_from_raw(a,e=!1){if(!fb_valid(a,!0))return!1;var t=fb_le_byte(a.substr(10,4));0>=t&&(t=54);for(var r={magic:0,filesize:1,reserved1:2,reserved2:3,offset:4,headersize:5,width:6,height:7,colorplane:8,bitdepth:9,compression:10,bitmapsize:11,reshor:12,resver:13,colorpalette:14,importantcolors:15,data:16},$=0,i=Object.keys(r);$<fb_header_parts_size;$++)if(void 0!==r[i[$]]){r[i[$]]={};var n=r[i[$]].addr=fb_header_parts[$].addr,f=r[i[$]].size=fb_header_parts[$].size;16==$&&(f=a.length-t,n=t),r[i[$]].data=a.substr(n,f)}var d=r.width.data,b=r.height.data,l=r.bitdepth.data,x=r.data.data;d=fb_le_byte(d),b=fb_le_byte(b),l=fb_le_byte(l);var o=fb_create(d,b,e);if(24==l){var a=byte_to_uint8clampedarray(x);for(let s=0;s<b;s++)for(let u=0;u<d;u++){var p=fb_getpos_24(d,b,u,s,!0),c=Number(a[p+2]),h=Number(a[p+1]),E=Number(a[p+0]);fb_set_pixel(o,u,s,c,h,E,255)}}if(32==l){var a=byte_to_uint8clampedarray(x);if(e)for(let v=0;v<b;v++)for(let m=0;m<d;m++){var p=fb_getpos_32(d,b,m,v,!0),c=Number(a[p+2]),h=Number(a[p+1]),E=Number(a[p+0]);fb_set_pixel(o,m,v,c,h,E,Number(a[p+3]))}else o.bitmap=new ImageData(a,d)}return o}function fb_getpos_24(a,e,t,r,$=!0){return t=3*Math.round(t),r=3*Math.round(r),$&&(r=Math.abs(r-3*e+3)),pos=Math.round((a+a%4/3)*r+t)}function fb_getpos_32(a,e,t,r,$=!0){return t=4*Math.round(t),r=4*Math.round(r),$&&(r=Math.abs(r-4*e+4)),a*r+t}function fb_request(a=null){return http_get_bytes(a)}function fb_copy(a){if(!fb_valid(a))return!1;var e=fb_create(a.width,a.height,a.canvas);return e.bitmap=structuredClone(a.bitmap),e.reference=a.reference,e}function fb_save(a,e="download.bmp"){if(!fb_valid(a))return!1;var t=document.createElement("a");return t.href=fb_create_uri(a),t.download=e,t.style="display:none",document.body.appendChild(t),t.click(),t.remove(),!0}function fb_to_canvas(a=null,e){return!!(null!=a&&a instanceof HTMLCanvasElement&&fb_valid(e))&&(a.width=e.bitmap.width,a.height=e.bitmap.height,a.context.putImageData(e.bitmap,0,0),!0)}function fb_load(a=null,e=!1){var t=fb_request(a);return!!fb_valid(t,!0)&&fb_from_raw(t,e)}function fb_plot_rect(_,t=0,$=0,r=10,e=10,o=255,f=255,i=255,l=!1){if(l)for(let n=$;n<e+$;n++)for(let h=t;h<r+t;h++)_.width>h&&_.height>n&&fb_set_pixel(_,h,n,o,f,i);else{var u=r+t,p=e+$;fb_plot_line(_,t,$,u-1,$,o,f,i),fb_plot_line(_,t,$,t,p,o,f,i),fb_plot_line(_,t,p-1,u-1,p-1,o,f,i),fb_plot_line(_,u-1,$,u-1,p,o,f,i)}return!0}function fb_plot_clear(_,t=0,$=0,r=0){for(let e=0;e<_.height;e++)for(let o=0;o<_.width;o++)fb_set_pixel(_,o,e,t,$,r);return!0}function fb_plot_line(_,t,$,r,e,o=255,f=255,i=255,l=1){l=clamp(l,.1,2);var n=r-t,h=e-$,u=Math.sqrt(n*n+h*h)*l,p=n/u,a=h/u;n=t,h=$;for(let c=0;c<u;c++)_.width>n&&_.height>h&&fb_set_pixel(_,n,h,o,f,i),n+=p,h+=a;return!0}function fb_plot_resource(_,t,$=0,r=0,e=-1,o=-1,f=0,i=0,l=!1,n=-1,h=-1,u=-1){var t=fb_copy(t);e=clamp(e,-1,t.width),o=clamp(o,-1,t.height),-1==e&&(e=t.width),-1==o&&(o=t.height);for(let p=0;p<e;p++)for(let a=0;a<o;a++)if(_.width>p+$&&_.height>a+r){var c=fb_get_pixel(t,p+f,a+i);if(l&&c[0]==n&&c[1]==h&&c[2]==u)continue;fb_set_pixel(_,p+$,a+r,c[0],c[1],c[2])}return!0}function fb_plot_text(_,t,$,r,e="A",o=!0,f=255,i=255,l=255,n=-1,h=-1,u=-1){var p=$,a=$,c=r,b=0,v=0,w=t.width/96,d=t.height,g=t.width/w,s=e.length;for(let x=0;x<s;x++){var A=e.charCodeAt(x),q=(A-32)*w;if(10==A||13==A){a=p,c+=d;continue}(32>A||A>126)&&(q=w*(g-1)),o&&a+w>_.width&&(a=p,c+=d);for(let C=v;C<d;C++)for(let E=b;E<w;E++){var j=fb_get_pixel(t,E+q,C);if(255==j[0]&&255==j[1]&&255==j[2]){if(-1==f||-1==i||-1==l)continue;j[0]=f,j[1]=i,j[2]=l}else if(0==j[0]&&0==j[1]&&0==j[2]){if(-1==n||-1==h||-1==h)continue;j[0]=n,j[1]=h,j[2]=u}_.width>a+E&&_.height>c+C&&fb_set_pixel(_,a+E,c+C,j[0],j[1],j[2])}a+=w}return!0}function fb_plot_circle(_,t,$,r,e,o,f,i,l=1,n=!1,h=!1,u=360){var p=r/2;n||(l=clamp(l=1/l,.5,10),l-=.5),!1==h&&(t+=r/2,$+=e/2),r=p/r*2.016,e=p/e*2.016;for(let a=0,c,b;a<u;a+=.05)c=p*Math.cos(deg2rad(a))/r,b=p*Math.sin(deg2rad(a))/e,n?fb_plot_line(_,t,$,t+c,$+b,o,f,i):(l>0&&(a+=l),fb_set_pixel(_,t+c,$+b,o,f,i));return!0}function fb_plot_arrow_up(_,t,$,r,e,o,f,i,l=1){var n=[[256,1],[512,256],[384,256],[384,512],[128,512],[128,256],[1,256],[256,1]];for(let h=1;h<8;h++){var u,p=n[h-1],a=n[h],c=p[0]/512*r+t,b=p[1]/512*e+$;fb_plot_line(_,c,b,a[0]/512*r+t,a[1]/512*e+$,o,f,i,l)}return!0}function fb_plot_arrow_down(_,t,$,r,e,o,f,i,l=1){var n=[[128,0],[384,0],[384,256],[512,256],[256,512],[0,256],[128,256],[128,0]];for(let h=1;h<8;h++){var u,p=n[h-1],a=n[h],c=p[0]/512*r+t,b=p[1]/512*e+$;fb_plot_line(_,c,b,a[0]/512*r+t,a[1]/512*e+$,o,f,i,l)}return!0}function fb_plot_arrow_left(_,t,$,r,e,o,f,i,l=1){var n=[[0,256],[256,0],[256,128],[512,128],[512,384],[256,384],[256,512],[0,256]];for(let h=1;h<8;h++){var u,p=n[h-1],a=n[h],c=p[0]/512*r+t,b=p[1]/512*e+$;fb_plot_line(_,c,b,a[0]/512*r+t,a[1]/512*e+$,o,f,i,l)}return!0}function fb_plot_arrow_right(_,t,$,r,e,o,f,i,l=1){var n=[[0,128],[256,128],[256,0],[512,256],[256,512],[256,384],[0,384],[0,128]];for(let h=1;h<8;h++){var u,p=n[h-1],a=n[h],c=p[0]/512*r+t,b=p[1]/512*e+$;fb_plot_line(_,c,b,a[0]/512*r+t,a[1]/512*e+$,o,f,i,l)}return!0}function fb_plot_triangle(_,t,$,r,e,o,f,i,l=1){var n=[[256,0],[512,512],[0,512],[256,0]];for(let h=1;h<4;h++){var u,p=n[h-1],a=n[h],c=p[0]/512*r+t,b=p[1]/512*e+$;fb_plot_line(_,c,b,a[0]/512*r+t,a[1]/512*e+$,o,f,i,l)}return!0}function fb_plot_fill(_,t,$,r,e,o,f=fb_set_pixel){var i=[];i.push([t,$]);var l=fb_get_pixel(_,t,$);if(null===f&&(f=fb_set_pixel),l[0]!=r||l[1]!=e||l[2]!=o){for(;i.length>0;){var[t,$]=i.pop(),n=fb_get_pixel(_,t,$);!(0>t)&&!(t>_.width)&&!(0>$)&&!($>_.height)&&n[0]==l[0]&&n[1]==l[1]&&n[2]==l[2]&&(f(_,t,$,r,e,o),i.push([t+1,$]),i.push([t-1,$]),i.push([t,$+1]),i.push([t,$-1]))}return!0}}function fb_mod_get_channel(_,$=0){$=clamp($,0,3);var r=fb_create(_.width,_.height,_.canvas);for(let t=0;t<_.height;t++)for(let o=0;o<_.width;o++){var n=fb_get_pixel(_,o,t);fb_set_pixel(r,o,t,n[$],n[$],n[$])}return r}function fb_mod_dissect_font(_){var $=_.width/96,r=_.height,t=_.width/$;return[$,r,t]}function fb_mod_flip_x(_){var $=_.width,r=_.height,t=fb_create($,r,_.canvas);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=fb_get_pixel(_,n,o);fb_set_pixel(t,Math.abs($-n)-1,o,e[0],e[1],e[2])}return t}function fb_mod_flip_y(_){var $=_.width,r=_.height,t=fb_create($,r,_.canvas);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=fb_get_pixel(_,n,o);fb_set_pixel(t,n,Math.abs(r-o)-1,e[0],e[1],e[2])}return t}function fb_mod_rotate_right(_){var $=_.width,r=_.height,t=fb_create(r,$,_.canvas);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=fb_get_pixel(_,n,o);fb_set_pixel(t,Math.abs(r-o)-1,n,e[0],e[1],e[2])}return t}function fb_mod_rotate_left(_){var $=_.width,r=_.height,t=fb_create(r,$,_.canvas);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=fb_get_pixel(_,n,o);fb_set_pixel(t,o,Math.abs($-n)-1,e[0],e[1],e[2])}return t}function fb_mod_replace_color(_,$,r,t,o,n,e){var f=_.width,a=_.height,i=fb_copy(_);for(let l=0;l<a;l++)for(let u=0;u<f;u++){var d=fb_get_pixel(_,u,l);d[0]==$&&d[1]==r&&d[2]==t&&fb_set_pixel(i,u,l,o,n,e)}return i}function fb_mod_color_invert(_){var $=_.width,r=_.height,t=fb_copy(_);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=fb_get_pixel(_,n,o);e[0]=Math.abs(e[0]-255),e[1]=Math.abs(e[1]-255),e[2]=Math.abs(e[2]-255),fb_set_pixel(t,n,o,e[0],e[1],e[2])}return t}function fb_mod_color_grayscale(_){var $=_.width,r=_.height,t=fb_create($,r,_.canvas);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=fb_get_pixel(_,n,o),e=clamp((e[0]+e[1]+e[2])/3,0,255);fb_set_pixel(t,n,o,e,e,e)}return t}function fb_mod_color_1bit(_){var $=_.width,r=_.height,t=fb_create($,r,_.canvas);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=fb_get_pixel(_,n,o);e=(e=clamp((e[0]+e[1]+e[2])/3,0,255))>127?255:0,fb_set_pixel(t,n,o,e,e,e)}return t}function fb_mod_noise_grayscale(_,$=.1){if(0==($=clamp($,0,10)))return _;var r=_.width,t=_.height,o=fb_copy(_);for(let n=0;n<t;n++)for(let e=0;e<r;e++){var f=fb_get_pixel(_,e,n),a=Math.floor(Math.random(0)*(255*$));f[0]=clamp(f[0]+a,0,255),f[1]=clamp(f[1]+a,0,255),f[2]=clamp(f[2]+a,0,255),fb_set_pixel(o,e,n,f[0],f[1],f[2])}return o}function fb_mod_noise_rgb(_,$=.1){if(0==($=clamp($,0,10)))return _;var r=_.width,t=_.height,o=fb_copy(_);for(let n=0;n<t;n++)for(let e=0;e<r;e++){var f=fb_get_pixel(_,e,n),a=Math.floor(Math.random(0)*(255*$)),i=Math.floor(Math.random(0)*(255*$)),l=Math.floor(Math.random(0)*(255*$));f[0]=clamp(f[0]+a,0,255),f[1]=clamp(f[1]+i,0,255),f[2]=clamp(f[2]+l,0,255),fb_set_pixel(o,e,n,f[0],f[1],f[2])}return o}function fb_mod_apply_convolution_matrix(_,$=[0,0,0,0,0,0,0,0,0],r=1,t=0){if(9!=$.length&&25!=$.length)throw"Convolution matrix must be of size 3x3 (9) or 5x5 (25)";var o=fb_copy(_),n=_.width,e=_.height,f=$;if(9==$.length)for(let a=0;a<n;a++)for(let i=0;i<e;i++){var l=fb_get_pixel(_,a-1,i-1),u=fb_get_pixel(_,a,i-1),d=fb_get_pixel(_,a+1,i-1),h=fb_get_pixel(_,a-1,i),v=fb_get_pixel(_,a,i),c=fb_get_pixel(_,a+1,i),b=fb_get_pixel(_,a-1,i+1),m=fb_get_pixel(_,a,i+1),s=fb_get_pixel(_,a+1,i+1);l[0]*=f[0],l[1]*=f[0],l[2]*=f[0],u[0]*=f[1],u[1]*=f[1],u[2]*=f[1],d[0]*=f[2],d[1]*=f[2],d[2]*=f[2],h[0]*=f[3],h[1]*=f[3],h[2]*=f[3],v[0]*=f[4],v[1]*=f[4],v[2]*=f[4],c[0]*=f[5],c[1]*=f[5],c[2]*=f[5],b[0]*=f[6],b[1]*=f[6],b[2]*=f[6],m[0]*=f[7],m[1]*=f[7],m[2]*=f[7],s[0]*=f[8],s[1]*=f[8],s[2]*=f[8];var g=[(l[0]+u[0]+d[0]+h[0]+v[0]+c[0]+b[0]+m[0]+s[0])/r,(l[1]+u[1]+d[1]+h[1]+v[1]+c[1]+b[1]+m[1]+s[1])/r,(l[2]+u[2]+d[2]+h[2]+v[2]+c[2]+b[2]+m[2]+s[2])/r];fb_set_pixel(o,a,i,g[0]+t,g[1]+t,g[2]+t)}if(25==$.length)for(let p=0;p<n;p++)for(let w=0;w<e;w++){var l=fb_get_pixel(_,p-2,w-2),u=fb_get_pixel(_,p-1,w-2),d=fb_get_pixel(_,p,w-2),x=fb_get_pixel(_,p+1,w-2),y=fb_get_pixel(_,p+2,w-2),h=fb_get_pixel(_,p-2,w-1),v=fb_get_pixel(_,p-1,w-1),c=fb_get_pixel(_,p,w-1),z=fb_get_pixel(_,p+1,w-1),C=fb_get_pixel(_,p+2,w-1),b=fb_get_pixel(_,p-2,w),m=fb_get_pixel(_,p-1,w),s=fb_get_pixel(_,p,w),j=fb_get_pixel(_,p+1,w),k=fb_get_pixel(_,p+2,w),q=fb_get_pixel(_,p-2,w+1),A=fb_get_pixel(_,p-1,w+1),B=fb_get_pixel(_,p,w+1),D=fb_get_pixel(_,p+1,w+1),E=fb_get_pixel(_,p+2,w+1),F=fb_get_pixel(_,p-2,w+2),G=fb_get_pixel(_,p-1,w+2),H=fb_get_pixel(_,p,w+2),I=fb_get_pixel(_,p+1,w+2),J=fb_get_pixel(_,p+2,w+2);l[0]*=f[0],l[1]*=f[0],l[2]*=f[0],u[0]*=f[1],u[1]*=f[1],u[2]*=f[1],d[0]*=f[2],d[1]*=f[2],d[2]*=f[2],x[0]*=f[3],x[1]*=f[3],x[2]*=f[3],y[0]*=f[4],y[1]*=f[4],y[2]*=f[4],h[0]*=f[5],h[1]*=f[5],h[2]*=f[5],v[0]*=f[6],v[1]*=f[6],v[2]*=f[6],c[0]*=f[7],c[1]*=f[7],c[2]*=f[7],z[0]*=f[8],z[1]*=f[8],z[2]*=f[8],C[0]*=f[9],C[1]*=f[9],C[2]*=f[9],b[0]*=f[10],b[1]*=f[10],b[2]*=f[10],m[0]*=f[11],m[1]*=f[11],m[2]*=f[11],s[0]*=f[12],s[1]*=f[12],s[2]*=f[12],j[0]*=f[13],j[1]*=f[13],j[2]*=f[13],k[0]*=f[14],k[1]*=f[14],k[2]*=f[14],q[0]*=f[15],q[1]*=f[15],q[2]*=f[15],A[0]*=f[16],A[1]*=f[16],A[2]*=f[16],B[0]*=f[17],B[1]*=f[17],B[2]*=f[17],D[0]*=f[18],D[1]*=f[18],D[2]*=f[18],E[0]*=f[19],E[1]*=f[19],E[2]*=f[19],F[0]*=f[20],F[1]*=f[20],F[2]*=f[20],G[0]*=f[21],G[1]*=f[21],G[2]*=f[21],H[0]*=f[22],H[1]*=f[22],H[2]*=f[22],I[0]*=f[23],I[1]*=f[23],I[2]*=f[23],J[0]*=f[24],J[1]*=f[24],J[2]*=f[24];var g=[(l[0]+u[0]+d[0]+x[0]+y[0]+h[0]+v[0]+c[0]+z[0]+C[0]+b[0]+m[0]+s[0]+j[0]+k[0]+q[0]+A[0]+B[0]+D[0]+E[0]+F[0]+G[0]+H[0]+I[0]+J[0])/r,(l[1]+u[1]+d[1]+x[1]+y[1]+h[1]+v[1]+c[1]+z[1]+C[1]+b[1]+m[1]+s[1]+j[1]+k[1]+q[1]+A[1]+B[1]+D[1]+E[1]+F[1]+G[1]+H[1]+I[1]+J[1])/r,(l[2]+u[2]+d[2]+x[2]+y[2]+h[2]+v[2]+c[2]+z[2]+C[2]+b[2]+m[2]+s[2]+j[2]+k[2]+q[2]+A[2]+B[2]+D[2]+E[2]+F[2]+G[2]+H[2]+I[2]+J[2])/r,];fb_set_pixel(o,p,w,g[0]+t,g[1]+t,g[2]+t)}return o}function fb_mod_sharpen(_){var $=fb_copy(_);return fb_mod_apply_convolution_matrix($,[0,-1,0,-1,5,-1,0,-1,0])}function fb_mod_resize(_,$,r){if($=Math.round($),r=Math.round(r),$==_.width&&r==_.height)return _;var t=fb_create($,r,_.canvas);xd=_.width/$,yd=_.height/r;for(let o=0;o<$;o++)for(let n=0;n<r;n++){var e=fb_get_pixel(_,xd*o,yd*n);for(let f=0;f<xd;f+=xd)for(let a=0;a<yd;a+=yd)fb_set_pixel(t,o+f,n+a,e[0],e[1],e[2],255)}return t}function fb_mod_pixelate(_,$=2){if(1==($=Math.round(clamp($,1))))return _;var r=fb_copy(_),t=_.width,o=_.height,n=clamp(Math.round(t/$),1),e=clamp(Math.round(o/$),1);return r=fb_mod_resize(r,n,e),r=fb_mod_resize(r,t,o)}function fb_mod_crop(_,$=0,r=0,t=1,o=1,n=0){$=Math.round(Math.abs($)),r=Math.round(Math.abs(r)),t=Math.round(Math.abs(t)),o=Math.round(Math.abs(o)),0==(n=clamp(n,0,1))&&($==t&&++t,r==o&&++o,$>t&&(tx=$,$=t,t=tx),r>o&&(ty=r,r=o,o=ty)),0==n&&(t=clamp(t,0,_.width),o=clamp(o,0,_.height)),1==n?(e=t,f=o):(e=Math.round(t-$),f=Math.round(o-r));var e,f,a=fb_create(e,f,_.canvas),i=e+$,l=f+r;for(let u=$;u<i;u++)for(let d=r;d<l;d++){var h=fb_get_pixel(_,u,d);fb_set_pixel(a,u-$,d-r,h[0],h[1],h[2])}return a}function fb_mod_detect_edge(_,$=0){$=clamp($,0,2);var r=fb_copy(_);return 0==$&&(r=fb_mod_apply_convolution_matrix(r,[1,0,-1,0,0,0,-1,0,1])),1==$&&(r=fb_mod_apply_convolution_matrix(r,[0,1,0,1,-4,1,0,1,0])),2==$&&(r=fb_mod_apply_convolution_matrix(r,[-1,-1,-1,-1,8,-1,-1,-1,-1])),r}function fb_mod_blur_box(_,$=1){var r=fb_copy(_);$=clamp($,1);for(let t=0;t<$;t++)r=fb_mod_apply_convolution_matrix(r,[1,1,1,1,1,1,1,1,1],9);return r}function fb_mod_blur_gaussian(_,$=1){var r=fb_copy(_);$=clamp($,1);for(let t=0;t<$;t++)r=fb_mod_apply_convolution_matrix(r,[1,2,1,2,4,2,1,2,1],16);return r}function fb_mod_emboss(_,$=1){var r=fb_copy(_);return $=clamp($,.01),r=fb_mod_apply_convolution_matrix(r,[-2*$,-1*$,0*$,-1*$,1*$,1*$,0*$,1*$,2*$],9)}