/*Copyright (C) 2022-2023 Nurudin Imsirovic <github.com/oxou> Updated: 2023-03-31 03:46 PM*/function hex2bin(n=null){if(null==n)return null;var r=(n=n.toLowerCase()).length;if(r%2)throw"Hexadecimal input string length must be even";var t="";for(let e=0;e<r;e+=2)t+=String.fromCharCode(parseInt(n.substr(e,2),16));return t}function bin2hex(n=null){if(null==n)return null;var r=n.length,t="";for(let e=0;e<r;e++){var u=n.charCodeAt(e).toString(16);2>u.length&&(u="0"+u),t+=u}return t}function hexdec(n=null){return null==n?null:parseInt(n,16)}function dechex(n=null){if(null==n)return null;var r=Number(n).toString(16);return r.length%2&&(r="0"+r),r}function str_split(n,r=1){if(0>=r&&(r=1),1==r)return n.split("");var t=n.length,e=[];for(let u=0;u<t/r;u++)e[u]=n.substr(u*r,r);return e}function clamp(n,r,t){return r>n?r:t<n?t:n}function time(){return Math.floor(Date.now()/1e3)}function time_precise(){return Date.now()}function byte_to_uint8clampedarray(n){return n=(n=str_split(n=bin2hex(n),2)).map(n=>hexdec(n)),Uint8ClampedArray.from(n)}function uint8clampedarray_to_byte(n){return n=(n=(n=[...n]).map(n=>hex2bin(dechex(n).padStart(2,"0")))).join("")}function http_get_bytes(n=null){if(null==n)return!1;var r=new XMLHttpRequest;if(r.open("GET",n,!1),r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(),200!=r.status)return null;for(var t=(data=r.response.split("")).length,e=0;e<t;e++){var u=bin2hex(data[e]);u.length>2&&(u=u.substr(2,2),data[e]=hex2bin(u))}return data.join("")}function lerp(n,r,t){return n+(r-n)*t}function deg2rad(n){return n*(Math.PI/180)}function rad2deg(n){return n*(180/Math.PI)}function in_range(n,r,t){return n>=r&&n<=t}function sgn(n){return(n>0)-(n<0)}const bmp_header_parts=[{size:2,data:"BM",addr:0},{addr:2,size:4,data:"\0\0\0\0"},{addr:6,size:2,data:"\0\0"},{addr:8,size:2,data:"\0\0"},{addr:10,size:4,data:"6\0\0\0"},{addr:14,size:4,data:"(\0\0\0"},{addr:18,size:4,data:"\0\0\0\0"},{addr:22,size:4,data:"\0\0\0\0"},{addr:26,size:2,data:"\x01\0"},{addr:28,size:2,data:" \0"},{addr:30,size:4,data:"\0\0\0\0"},{addr:34,size:4,data:"\0\0\0\0"},{addr:38,size:4,data:"\0\0\0\0"},{addr:42,size:4,data:"\0\0\0\0"},{addr:46,size:4,data:"\0\0\0\0"},{addr:50,size:4,data:"\0\0\0\0"},{addr:54,size:-1,data:null}];var bmp_header_parts_size=17;const BMP_HEADER_MAGIC=0,BMP_HEADER_FILESIZE=1,BMP_HEADER_RESERVED1=2,BMP_HEADER_RESERVED2=3,BMP_HEADER_OFFSET=4,BMP_HEADER_HEADERSIZE=5,BMP_HEADER_WIDTH=6,BMP_HEADER_HEIGHT=7,BMP_HEADER_COLORPLANE=8,BMP_HEADER_BITDEPTH=9,BMP_HEADER_COMPRESSION=10,BMP_HEADER_BITMAPSIZE=11,BMP_HEADER_RESHOR=12,BMP_HEADER_RESVER=13,BMP_HEADER_COLORPALETTE=14,BMP_HEADER_IMPORTANTCOLORS=15,BMP_HEADER_DATA=16;function bmp_le_int(a,e=2,t=!0){return a=dechex(a),a=hex2bin(a=(a=(a=str_split(a=t?a.padStart(e,"0"):a.padEnd(e,"0"),2)).reverse()).join(""))}function bmp_le_byte(a){return Number(a=hexdec(a=(a=(a=str_split(a=bin2hex(a),2)).reverse()).join("")))}function bmp_create(a,e,t=!1){if(a=Math.floor(a),e=Math.floor(e),16384<a||16384<e)return!1;var r=bmp_header_parts,$="",i=a%4,n=bmp_create_pixels(a,e),d=a*e*4+e*i;return r.forEach(function(t,i){switch(i){case 1:$+=bmp_le_int(d+54,8);return;case 6:$+=bmp_le_int(a,8);return;case 7:$+=bmp_le_int(e,8);return;case 11:$+=bmp_le_int(d,8);return}null!=r[i].data&&($+=r[i].data)}),{header:byte_to_uint8clampedarray($),header_size:$.length,header_raw:$,width:a,height:e,bitmap:n,bitmap_raw:null,bitmap_size:d,padding:i,filesize:a*e*4+54,bpp:4,canvas:t,reference:null}}function bmp_valid(a,e=!1){var t=e?a:a.header_raw,r=!1;try{r="B"==t[0]&&"M"==t[1]}catch($){return!1}return r}function bmp_get_pixel(a,e,t){if(e=Math.floor(e),t=Math.floor(t),e>a.width-1||t>a.height-1||0>e||0>t)return[0,0,0,255];var r,$,i,n,d=bmp_getpos_32(a.width,a.height,e,t,!a.canvas);return a.canvas?(i=Number(a.bitmap.data[d+2]),$=Number(a.bitmap.data[d+1]),r=Number(a.bitmap.data[d+0]),n=Number(a.bitmap.data[d+3])):(i=Number(a.bitmap.data[d+0]),$=Number(a.bitmap.data[d+1]),r=Number(a.bitmap.data[d+2]),n=Number(a.bitmap.data[d+3])),r=isNaN(r)?0:r,$=isNaN($)?0:$,[r,$,i=isNaN(i)?0:i,n=isNaN(n)?0:n]}function bmp_set_pixel(a,e,t,r=null,$=null,i=null,n=null){if(e=Math.floor(e),t=Math.floor(t),e>a.width-1||t>a.height-1||0>e||0>t)return!0;r=Math.floor(Number(r)),$=Math.floor(Number($)),i=Math.floor(Number(i)),r=isNaN(r)?0:r,$=isNaN($)?0:$,i=isNaN(i)?0:i;var d=bmp_getpos_32(a.width,a.height,e,t,!a.canvas);return a.canvas?(a.bitmap.data[d+0]=r,a.bitmap.data[d+1]=$,a.bitmap.data[d+2]=i,null!=n&&(a.bitmap.data[d+3]=n),!0):(a.bitmap.data[d+0]=i,a.bitmap.data[d+1]=$,a.bitmap.data[d+2]=r,null!=n&&(a.bitmap.data[d+3]=n),!0)}function bmp_to_bytes(a){var e=a.bitmap.data,t=a.width,r=a.padding,$="";return e=str_split(e=(e=(e=[...e]).map(a=>dechex(a).padStart(2,"0"))).join(""),6*t),$=String("00").repeat(r),e=hex2bin(e=e.join($)+$),a.bitmap_raw=e,!0}function bmp_size(a){return!!bmp_valid(a)&&[a.width,a.height]}function bmp_get_pixels(a){return!!bmp_valid(a)&&a.bitmap.data}function bmp_create_pixels(a,e){a=Math.abs(a),e=Math.abs(e);var t=new ImageData(a,e);for(let r=0;r<a;r++)for(let $=0;$<e;$++){var i=bmp_getpos_32(a,e,r,$);t.data[i+3]=255}return t}function bmp_reset_alpha(a){if(!bmp_valid(a))return!1;for(let e=0;e<width;e++)for(let t=0;t<height;t++){var r=bmp_getpos_32(width,height,e,t);a.bitmap.data[r+3]=255}return!0}function bmp_create_uri(a){var e=a;if(a.canvas){e=bmp_create(a.width,a.height);for(let t=0;t<a.width;t++)for(let r=0;r<a.height;r++){var $=bmp_get_pixel(a,t,r);bmp_set_pixel(e,t,r,$[0],$[1],$[2])}}var i=new Blob([e.header,e.bitmap.data],{type:"image/bmp"});return URL.createObjectURL(i)}function bmp_spawn(a,e=null){if(!bmp_valid(a)||null==e)return!1;if(a.canvas){var t=document.createElement("canvas");return t.context=t.getContext("2d",{alpha:!1}),e.appendChild(t),t.width=a.width,t.height=a.height,bmp_to_canvas(t,a),a.reference=t,t}var r=document.createElement("img");return r.src=bmp_create_uri(a),e.appendChild(r),a.reference=r,r}function bmp_replace(a=null,e){return!!(null!=a&&bmp_valid(e))&&(a instanceof HTMLCanvasElement?(bmp_to_canvas(a,e),!0):(URL.revokeObjectURL(a.src),a.src=bmp_create_uri(e),!0))}function bmp_filesize(a){return a.filesize}function bmp_from_raw(a,e=!1){if(!bmp_valid(a,!0))return!1;var t=bmp_le_byte(a.substr(10,4));0>=t&&(t=54);for(var r={magic:0,filesize:1,reserved1:2,reserved2:3,offset:4,headersize:5,width:6,height:7,colorplane:8,bitdepth:9,compression:10,bitmapsize:11,reshor:12,resver:13,colorpalette:14,importantcolors:15,data:16},$=0,i=Object.keys(r);$<bmp_header_parts_size;$++)if(void 0!==r[i[$]]){r[i[$]]={};var n=r[i[$]].addr=bmp_header_parts[$].addr,d=r[i[$]].size=bmp_header_parts[$].size;16==$&&(d=a.length-t,n=t),r[i[$]].data=a.substr(n,d)}var p=r.width.data,b=r.height.data,m=r.bitdepth.data,l=r.data.data;p=bmp_le_byte(p),b=bmp_le_byte(b),m=bmp_le_byte(m);var x=bmp_create(p,b,e);if(24==m){var a=byte_to_uint8clampedarray(l);for(let o=0;o<b;o++)for(let s=0;s<p;s++){var u=bmp_getpos_24(p,b,s,o,!0),c=Number(a[u+2]),f=Number(a[u+1]),h=Number(a[u+0]);bmp_set_pixel(x,s,o,c,f,h,255)}}if(32==m){var a=byte_to_uint8clampedarray(l);if(e)for(let E=0;E<b;E++)for(let v=0;v<p;v++){var u=bmp_getpos_32(p,b,v,E,!0),c=Number(a[u+2]),f=Number(a[u+1]),h=Number(a[u+0]);bmp_set_pixel(x,v,E,c,f,h,Number(a[u+3]))}else x.bitmap=new ImageData(a,p)}return x}function bmp_getpos_24(a,e,t,r,$=!0){return t=3*Math.round(t),r=3*Math.round(r),$&&(r=Math.abs(r-3*e+3)),pos=Math.round((a+a%4/3)*r+t)}function bmp_getpos_32(a,e,t,r,$=!0){return t=4*Math.round(t),r=4*Math.round(r),$&&(r=Math.abs(r-4*e+4)),a*r+t}function bmp_request(a=null){return http_get_bytes(a)}function bmp_copy(a){if(!bmp_valid(a))return!1;var e=bmp_create(a.width,a.height,a.canvas);return e.bitmap=structuredClone(a.bitmap),e.reference=a.reference,e}function bmp_save(a,e="download.bmp"){if(!bmp_valid(a))return!1;var t=document.createElement("a");return t.href=bmp_create_uri(a),t.download=e,t.style="display:none",document.body.appendChild(t),t.click(),t.remove(),!0}function bmp_to_canvas(a=null,e){return!!(null!=a&&a instanceof HTMLCanvasElement&&bmp_valid(e))&&(a.width=e.bitmap.width,a.height=e.bitmap.height,a.context.putImageData(e.bitmap,0,0),!0)}function bmp_load(a=null,e=!1){var t=bmp_request(a);return!!bmp_valid(t,!0)&&bmp_from_raw(t,e)}function bmp_plot_rect(_,t=0,$=0,r=10,e=10,o=255,i=255,l=255,n=!1){if(n)for(let p=$;p<e+$;p++)for(let f=t;f<r+t;f++)_.width>f&&_.height>p&&bmp_set_pixel(_,f,p,o,i,l);else{var h=r+t,u=e+$;bmp_plot_line(_,t,$,h-1,$,o,i,l),bmp_plot_line(_,t,$,t,u,o,i,l),bmp_plot_line(_,t,u-1,h-1,u-1,o,i,l),bmp_plot_line(_,h-1,$,h-1,u,o,i,l)}return!0}function bmp_plot_clear(_,t=0,$=0,r=0){for(let e=0;e<_.height;e++)for(let o=0;o<_.width;o++)bmp_set_pixel(_,o,e,t,$,r);return!0}function bmp_plot_line(_,t,$,r,e,o=255,i=255,l=255,n=1){n=clamp(n,.1,2);var p=r-t,f=e-$,h=Math.sqrt(p*p+f*f)*n,u=p/h,a=f/h;p=t,f=$;for(let c=0;c<h;c++)_.width>p&&_.height>f&&bmp_set_pixel(_,p,f,o,i,l),p+=u,f+=a;return!0}function bmp_plot_resource(_,t,$=0,r=0,e=-1,o=-1,i=0,l=0,n=!1,p=-1,f=-1,h=-1){var t=bmp_copy(t);e=clamp(e,-1,t.width),o=clamp(o,-1,t.height),-1==e&&(e=t.width),-1==o&&(o=t.height);for(let u=0;u<e;u++)for(let a=0;a<o;a++)if(_.width>u+$&&_.height>a+r){var c=bmp_get_pixel(t,u+i,a+l);if(n&&c[0]==p&&c[1]==f&&c[2]==h)continue;bmp_set_pixel(_,u+$,a+r,c[0],c[1],c[2])}return!0}function bmp_plot_text(_,t,$,r,e="A",o=!0,i=255,l=255,n=255,p=-1,f=-1,h=-1){var u=$,a=$,c=r,b=0,m=0,v=t.width/96,w=t.height,d=t.width/v,g=e.length;for(let s=0;s<g;s++){var x=e.charCodeAt(s),A=(x-32)*v;if(10==x||13==x){a=u,c+=w;continue}(32>x||x>126)&&(A=v*(d-1)),o&&a+v>_.width&&(a=u,c+=w);for(let q=m;q<w;q++)for(let C=b;C<v;C++){var E=bmp_get_pixel(t,C+A,q);if(255==E[0]&&255==E[1]&&255==E[2]){if(-1==i||-1==l||-1==n)continue;E[0]=i,E[1]=l,E[2]=n}else if(0==E[0]&&0==E[1]&&0==E[2]){if(-1==p||-1==f||-1==f)continue;E[0]=p,E[1]=f,E[2]=h}_.width>a+C&&_.height>c+q&&bmp_set_pixel(_,a+C,c+q,E[0],E[1],E[2])}a+=v}return!0}function bmp_plot_circle(_,t,$,r,e,o,i,l,n=1,p=!1,f=!1,h=360){var u=r/2;p||(n=clamp(n=1/n,.5,10),n-=.5),!1==f&&(t+=r/2,$+=e/2),r=u/r*2.016,e=u/e*2.016;for(let a=0,c,b;a<h;a+=.05)c=u*Math.cos(deg2rad(a))/r,b=u*Math.sin(deg2rad(a))/e,p?bmp_plot_line(_,t,$,t+c,$+b,o,i,l):(n>0&&(a+=n),bmp_set_pixel(_,t+c,$+b,o,i,l));return!0}function bmp_plot_arrow_up(_,t,$,r,e,o,i,l,n=1){var p=[[256,1],[512,256],[384,256],[384,512],[128,512],[128,256],[1,256],[256,1]];for(let f=1;f<8;f++){var h,u=p[f-1],a=p[f],c=u[0]/512*r+t,b=u[1]/512*e+$;bmp_plot_line(_,c,b,a[0]/512*r+t,a[1]/512*e+$,o,i,l,n)}return!0}function bmp_plot_arrow_down(_,t,$,r,e,o,i,l,n=1){var p=[[128,0],[384,0],[384,256],[512,256],[256,512],[0,256],[128,256],[128,0]];for(let f=1;f<8;f++){var h,u=p[f-1],a=p[f],c=u[0]/512*r+t,b=u[1]/512*e+$;bmp_plot_line(_,c,b,a[0]/512*r+t,a[1]/512*e+$,o,i,l,n)}return!0}function bmp_plot_arrow_left(_,t,$,r,e,o,i,l,n=1){var p=[[0,256],[256,0],[256,128],[512,128],[512,384],[256,384],[256,512],[0,256]];for(let f=1;f<8;f++){var h,u=p[f-1],a=p[f],c=u[0]/512*r+t,b=u[1]/512*e+$;bmp_plot_line(_,c,b,a[0]/512*r+t,a[1]/512*e+$,o,i,l,n)}return!0}function bmp_plot_arrow_right(_,t,$,r,e,o,i,l,n=1){var p=[[0,128],[256,128],[256,0],[512,256],[256,512],[256,384],[0,384],[0,128]];for(let f=1;f<8;f++){var h,u=p[f-1],a=p[f],c=u[0]/512*r+t,b=u[1]/512*e+$;bmp_plot_line(_,c,b,a[0]/512*r+t,a[1]/512*e+$,o,i,l,n)}return!0}function bmp_plot_triangle(_,t,$,r,e,o,i,l,n=1){var p=[[256,0],[512,512],[0,512],[256,0]];for(let f=1;f<4;f++){var h,u=p[f-1],a=p[f],c=u[0]/512*r+t,b=u[1]/512*e+$;bmp_plot_line(_,c,b,a[0]/512*r+t,a[1]/512*e+$,o,i,l,n)}return!0}function bmp_plot_fill(_,t,$,r,e,o,i=bmp_set_pixel){var l=[];l.push([t,$]);var n=bmp_get_pixel(_,t,$);if(null===i&&(i=bmp_set_pixel),n[0]!=r||n[1]!=e||n[2]!=o){for(;l.length>0;){var[t,$]=l.pop(),p=bmp_get_pixel(_,t,$);!(0>t)&&!(t>_.width)&&!(0>$)&&!($>_.height)&&p[0]==n[0]&&p[1]==n[1]&&p[2]==n[2]&&(i(_,t,$,r,e,o),l.push([t+1,$]),l.push([t-1,$]),l.push([t,$+1]),l.push([t,$-1]))}return!0}}function bmp_mod_get_channel(_,$=0){$=clamp($,0,3);var r=bmp_create(_.width,_.height,_.canvas);for(let t=0;t<_.height;t++)for(let o=0;o<_.width;o++){var n=bmp_get_pixel(_,o,t);bmp_set_pixel(r,o,t,n[$],n[$],n[$])}return r}function bmp_mod_dissect_font(_){var $=_.width/96,r=_.height,t=_.width/$;return[$,r,t]}function bmp_mod_flip_x(_){var $=_.width,r=_.height,t=bmp_create($,r,_.canvas);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=bmp_get_pixel(_,n,o);bmp_set_pixel(t,Math.abs($-n)-1,o,e[0],e[1],e[2])}return t}function bmp_mod_flip_y(_){var $=_.width,r=_.height,t=bmp_create($,r,_.canvas);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=bmp_get_pixel(_,n,o);bmp_set_pixel(t,n,Math.abs(r-o)-1,e[0],e[1],e[2])}return t}function bmp_mod_rotate_right(_){var $=_.width,r=_.height,t=bmp_create(r,$,_.canvas);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=bmp_get_pixel(_,n,o);bmp_set_pixel(t,Math.abs(r-o)-1,n,e[0],e[1],e[2])}return t}function bmp_mod_rotate_left(_){var $=_.width,r=_.height,t=bmp_create(r,$,_.canvas);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=bmp_get_pixel(_,n,o);bmp_set_pixel(t,o,Math.abs($-n)-1,e[0],e[1],e[2])}return t}function bmp_mod_replace_color(_,$,r,t,o,n,e){var a=_.width,i=_.height,m=bmp_copy(_);for(let l=0;l<i;l++)for(let f=0;f<a;f++){var u=bmp_get_pixel(_,f,l);u[0]==$&&u[1]==r&&u[2]==t&&bmp_set_pixel(m,f,l,o,n,e)}return m}function bmp_mod_color_invert(_){var $=_.width,r=_.height,t=bmp_copy(_);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=bmp_get_pixel(_,n,o);e[0]=Math.abs(e[0]-255),e[1]=Math.abs(e[1]-255),e[2]=Math.abs(e[2]-255),bmp_set_pixel(t,n,o,e[0],e[1],e[2])}return t}function bmp_mod_color_grayscale(_){var $=_.width,r=_.height,t=bmp_create($,r,_.canvas);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=bmp_get_pixel(_,n,o),e=clamp((e[0]+e[1]+e[2])/3,0,255);bmp_set_pixel(t,n,o,e,e,e)}return t}function bmp_mod_color_1bit(_){var $=_.width,r=_.height,t=bmp_create($,r,_.canvas);for(let o=0;o<r;o++)for(let n=0;n<$;n++){var e=bmp_get_pixel(_,n,o);e=(e=clamp((e[0]+e[1]+e[2])/3,0,255))>127?255:0,bmp_set_pixel(t,n,o,e,e,e)}return t}function bmp_mod_noise_grayscale(_,$=.1){if(0==($=clamp($,0,10)))return _;var r=_.width,t=_.height,o=bmp_copy(_);for(let n=0;n<t;n++)for(let e=0;e<r;e++){var a=bmp_get_pixel(_,e,n),i=Math.floor(Math.random(0)*(255*$));a[0]=clamp(a[0]+i,0,255),a[1]=clamp(a[1]+i,0,255),a[2]=clamp(a[2]+i,0,255),bmp_set_pixel(o,e,n,a[0],a[1],a[2])}return o}function bmp_mod_noise_rgb(_,$=.1){if(0==($=clamp($,0,10)))return _;var r=_.width,t=_.height,o=bmp_copy(_);for(let n=0;n<t;n++)for(let e=0;e<r;e++){var a=bmp_get_pixel(_,e,n),i=Math.floor(Math.random(0)*(255*$)),m=Math.floor(Math.random(0)*(255*$)),l=Math.floor(Math.random(0)*(255*$));a[0]=clamp(a[0]+i,0,255),a[1]=clamp(a[1]+m,0,255),a[2]=clamp(a[2]+l,0,255),bmp_set_pixel(o,e,n,a[0],a[1],a[2])}return o}function bmp_mod_apply_convolution_matrix(_,$=[0,0,0,0,0,0,0,0,0],r=1,t=0){if(9!=$.length&&25!=$.length)throw"Convolution matrix must be of size 3x3 (9) or 5x5 (25)";var o=bmp_copy(_),n=_.width,e=_.height,a=$;if(9==$.length)for(let i=0;i<n;i++)for(let m=0;m<e;m++){var l=bmp_get_pixel(_,i-1,m-1),f=bmp_get_pixel(_,i,m-1),u=bmp_get_pixel(_,i+1,m-1),d=bmp_get_pixel(_,i-1,m),h=bmp_get_pixel(_,i,m),v=bmp_get_pixel(_,i+1,m),p=bmp_get_pixel(_,i-1,m+1),c=bmp_get_pixel(_,i,m+1),b=bmp_get_pixel(_,i+1,m+1);l[0]*=a[0],l[1]*=a[0],l[2]*=a[0],f[0]*=a[1],f[1]*=a[1],f[2]*=a[1],u[0]*=a[2],u[1]*=a[2],u[2]*=a[2],d[0]*=a[3],d[1]*=a[3],d[2]*=a[3],h[0]*=a[4],h[1]*=a[4],h[2]*=a[4],v[0]*=a[5],v[1]*=a[5],v[2]*=a[5],p[0]*=a[6],p[1]*=a[6],p[2]*=a[6],c[0]*=a[7],c[1]*=a[7],c[2]*=a[7],b[0]*=a[8],b[1]*=a[8],b[2]*=a[8];var s=[(l[0]+f[0]+u[0]+d[0]+h[0]+v[0]+p[0]+c[0]+b[0])/r,(l[1]+f[1]+u[1]+d[1]+h[1]+v[1]+p[1]+c[1]+b[1])/r,(l[2]+f[2]+u[2]+d[2]+h[2]+v[2]+p[2]+c[2]+b[2])/r];bmp_set_pixel(o,i,m,s[0]+t,s[1]+t,s[2]+t)}if(25==$.length)for(let g=0;g<n;g++)for(let w=0;w<e;w++){var l=bmp_get_pixel(_,g-2,w-2),f=bmp_get_pixel(_,g-1,w-2),u=bmp_get_pixel(_,g,w-2),x=bmp_get_pixel(_,g+1,w-2),y=bmp_get_pixel(_,g+2,w-2),d=bmp_get_pixel(_,g-2,w-1),h=bmp_get_pixel(_,g-1,w-1),v=bmp_get_pixel(_,g,w-1),z=bmp_get_pixel(_,g+1,w-1),C=bmp_get_pixel(_,g+2,w-1),p=bmp_get_pixel(_,g-2,w),c=bmp_get_pixel(_,g-1,w),b=bmp_get_pixel(_,g,w),j=bmp_get_pixel(_,g+1,w),k=bmp_get_pixel(_,g+2,w),q=bmp_get_pixel(_,g-2,w+1),A=bmp_get_pixel(_,g-1,w+1),B=bmp_get_pixel(_,g,w+1),D=bmp_get_pixel(_,g+1,w+1),E=bmp_get_pixel(_,g+2,w+1),F=bmp_get_pixel(_,g-2,w+2),G=bmp_get_pixel(_,g-1,w+2),H=bmp_get_pixel(_,g,w+2),I=bmp_get_pixel(_,g+1,w+2),J=bmp_get_pixel(_,g+2,w+2);l[0]*=a[0],l[1]*=a[0],l[2]*=a[0],f[0]*=a[1],f[1]*=a[1],f[2]*=a[1],u[0]*=a[2],u[1]*=a[2],u[2]*=a[2],x[0]*=a[3],x[1]*=a[3],x[2]*=a[3],y[0]*=a[4],y[1]*=a[4],y[2]*=a[4],d[0]*=a[5],d[1]*=a[5],d[2]*=a[5],h[0]*=a[6],h[1]*=a[6],h[2]*=a[6],v[0]*=a[7],v[1]*=a[7],v[2]*=a[7],z[0]*=a[8],z[1]*=a[8],z[2]*=a[8],C[0]*=a[9],C[1]*=a[9],C[2]*=a[9],p[0]*=a[10],p[1]*=a[10],p[2]*=a[10],c[0]*=a[11],c[1]*=a[11],c[2]*=a[11],b[0]*=a[12],b[1]*=a[12],b[2]*=a[12],j[0]*=a[13],j[1]*=a[13],j[2]*=a[13],k[0]*=a[14],k[1]*=a[14],k[2]*=a[14],q[0]*=a[15],q[1]*=a[15],q[2]*=a[15],A[0]*=a[16],A[1]*=a[16],A[2]*=a[16],B[0]*=a[17],B[1]*=a[17],B[2]*=a[17],D[0]*=a[18],D[1]*=a[18],D[2]*=a[18],E[0]*=a[19],E[1]*=a[19],E[2]*=a[19],F[0]*=a[20],F[1]*=a[20],F[2]*=a[20],G[0]*=a[21],G[1]*=a[21],G[2]*=a[21],H[0]*=a[22],H[1]*=a[22],H[2]*=a[22],I[0]*=a[23],I[1]*=a[23],I[2]*=a[23],J[0]*=a[24],J[1]*=a[24],J[2]*=a[24];var s=[(l[0]+f[0]+u[0]+x[0]+y[0]+d[0]+h[0]+v[0]+z[0]+C[0]+p[0]+c[0]+b[0]+j[0]+k[0]+q[0]+A[0]+B[0]+D[0]+E[0]+F[0]+G[0]+H[0]+I[0]+J[0])/r,(l[1]+f[1]+u[1]+x[1]+y[1]+d[1]+h[1]+v[1]+z[1]+C[1]+p[1]+c[1]+b[1]+j[1]+k[1]+q[1]+A[1]+B[1]+D[1]+E[1]+F[1]+G[1]+H[1]+I[1]+J[1])/r,(l[2]+f[2]+u[2]+x[2]+y[2]+d[2]+h[2]+v[2]+z[2]+C[2]+p[2]+c[2]+b[2]+j[2]+k[2]+q[2]+A[2]+B[2]+D[2]+E[2]+F[2]+G[2]+H[2]+I[2]+J[2])/r,];bmp_set_pixel(o,g,w,s[0]+t,s[1]+t,s[2]+t)}return o}function bmp_mod_sharpen(_){var $=bmp_copy(_);return bmp_mod_apply_convolution_matrix($,[0,-1,0,-1,5,-1,0,-1,0])}function bmp_mod_resize(_,$,r){if($=Math.round($),r=Math.round(r),$==_.width&&r==_.height)return _;var t=bmp_create($,r,_.canvas);xd=_.width/$,yd=_.height/r;for(let o=0;o<$;o++)for(let n=0;n<r;n++){var e=bmp_get_pixel(_,xd*o,yd*n);for(let a=0;a<xd;a+=xd)for(let i=0;i<yd;i+=yd)bmp_set_pixel(t,o+a,n+i,e[0],e[1],e[2],255)}return t}function bmp_mod_pixelate(_,$=2){if(1==($=Math.round(clamp($,1))))return _;var r=bmp_copy(_),t=_.width,o=_.height,n=clamp(Math.round(t/$),1),e=clamp(Math.round(o/$),1);return r=bmp_mod_resize(r,n,e),r=bmp_mod_resize(r,t,o)}function bmp_mod_crop(_,$=0,r=0,t=1,o=1,n=0){$=Math.round(Math.abs($)),r=Math.round(Math.abs(r)),t=Math.round(Math.abs(t)),o=Math.round(Math.abs(o)),0==(n=clamp(n,0,1))&&($==t&&++t,r==o&&++o,$>t&&(tx=$,$=t,t=tx),r>o&&(ty=r,r=o,o=ty)),0==n&&(t=clamp(t,0,_.width),o=clamp(o,0,_.height)),1==n?(e=t,a=o):(e=Math.round(t-$),a=Math.round(o-r));var e,a,i=bmp_create(e,a,_.canvas),m=e+$,l=a+r;for(let f=$;f<m;f++)for(let u=r;u<l;u++){var d=bmp_get_pixel(_,f,u);bmp_set_pixel(i,f-$,u-r,d[0],d[1],d[2])}return i}function bmp_mod_detect_edge(_,$=0){$=clamp($,0,2);var r=bmp_copy(_);return 0==$&&(r=bmp_mod_apply_convolution_matrix(r,[1,0,-1,0,0,0,-1,0,1])),1==$&&(r=bmp_mod_apply_convolution_matrix(r,[0,1,0,1,-4,1,0,1,0])),2==$&&(r=bmp_mod_apply_convolution_matrix(r,[-1,-1,-1,-1,8,-1,-1,-1,-1])),r}function bmp_mod_blur_box(_,$=1){var r=bmp_copy(_);$=clamp($,1);for(let t=0;t<$;t++)r=bmp_mod_apply_convolution_matrix(r,[1,1,1,1,1,1,1,1,1],9);return r}function bmp_mod_blur_gaussian(_,$=1){var r=bmp_copy(_);$=clamp($,1);for(let t=0;t<$;t++)r=bmp_mod_apply_convolution_matrix(r,[1,2,1,2,4,2,1,2,1],16);return r}function bmp_mod_emboss(_,$=1){var r=bmp_copy(_);return $=clamp($,.01),r=bmp_mod_apply_convolution_matrix(r,[-2*$,-1*$,0*$,-1*$,1*$,1*$,0*$,1*$,2*$],9)}